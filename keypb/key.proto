// This file defines a storage format for an encrypted key file.  A key file is
// symmetrically encrypted based on a passphrase.

syntax = "proto3";

package keypb;

// Keyfile is the storage format for a key file. The keys in a file are
// encrypted with AES-256 using a key derived from a passphrase using scrypt.
message Keyfile {
  // The keys in the file are encrypted with AES-256, the key for each of which
  // is generated by the scrypt algorithm from the passphrase.

  repeated Key keys = 1; // encrypted keys

  // A Key is stored as a wire-format Secret which has been encrypted in CTR
  // mode. Each key has a slug that can be used to choose which key to decrypt.
  // Since key secrets are expected to be both short and random, they are not
  // compressed before storage.
  message Key {
    string slug = 1; // descriptive slug for this key (non-secret)
    bytes data = 2;  // encrypted Secret
    bytes init = 3;  // initialization vector
    bytes salt = 4;  // key generation salt
  }

  message Secret {
    bytes secret = 1; // the protected secret
    uint32 check = 2; // checksum of secret bytes as a key verifier
  }
}
